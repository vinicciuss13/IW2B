<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CADASTRO</title>
    <link rel="website icon" href="data:image/png;base64,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" type="png" >
    <style>
    body {
      background: #f6f3ee;
      color: #2d2d2d;
      font-family: 'Merriweather', serif;
      margin: 0;
      padding: 2rem;
    }
    .logo {
      display: block;
      margin: 0 auto 1.5rem;
      width: 90px;
      filter: none;
    }
    h2 {
      font-weight: 700;
      letter-spacing: 2px;
      color: #3e2f1c;
      text-align: center;
      margin-bottom: 2rem;
      text-transform: uppercase;
      font-family: 'Merriweather', serif;
      text-shadow: 0 2px 8px #e5dcc3;
    }
    #tabela {
      width: 100%;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgb(62 47 28 / 0.08);
      border-collapse: separate;
      margin-top: 2rem;
      background: #fffbe6;
    }
    #tabela thead th {
      background: #e5dcc3;
      color: #3e2f1c;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      padding: 0.8rem 1rem;
      border-bottom: 1px solid #d1c2a0;
      text-align: center;
      font-family: 'Merriweather', serif;
    }
    #tabela tbody td {
      background-color: #fffbe6;
      padding: 0.8rem 1rem;
      border-bottom: 1px solid #e5dcc3;
      text-align: center;
      font-size: 1rem;
      font-family: 'Merriweather', serif;
    }
    #tabela tbody tr:hover {
      background-color: #f3ecd2;
    }
    #botaoSalvar {
      background-color: #3e2f1c;
      border: none;
      border-radius: 50px;
      font-weight: 700;
      font-size: 1rem;
      padding: 0.6rem 2rem;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      transition: background-color 0.3s ease;
      color: #fff;
      box-shadow: 0 2px 8px #e5dcc3;
    }
    #botaoSalvar:hover {
      background-color: #e5dcc3;
      color: #3e2f1c;
    }
    #botaoLimpar {
      border-radius: 50px;
      font-weight: 700;
      font-size: 1rem;
      padding: 0.6rem 2rem;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      transition: background-color 0.3s ease;
      color: #3e2f1c;
      border: 2px solid #3e2f1c;
      background-color: #fffbe6;
      box-shadow: 0 2px 8px #e5dcc3;
    }
    #botaoLimpar:hover {
      background-color: #3e2f1c;
      color: #fff;
    }
    #botaoListar {
      background-color: #3e2f1c;
      border: none;
      border-radius: 50px;
      font-weight: 700;
      font-size: 1rem;
      padding: 0.6rem 2rem;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      transition: background-color 0.3s ease;
      color: #fff;
      margin-right: 1rem;
      box-shadow: 0 2px 8px #e5dcc3;
    }
    #botaoListar:hover {
      background-color: #e5dcc3;
      color: #3e2f1c;
    }
    #botao {
      border-radius: 50px;
      font-weight: 700;
      font-size: 1rem;
      padding: 0.6rem 2rem;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      transition: background-color 0.3s ease;
      color: #3e2f1c;
      border: 2px solid #3e2f1c;
      background-color: #fffbe6;
      box-shadow: 0 2px 8px #e5dcc3;
    }

    #botao:hover {
      background-color: #3e2f1c;
      color: #fff;
    }
    .form-control, .form-select {
      border-radius: 8px;
      border: 1px solid #d1c2a0;
      font-family: 'Merriweather', serif;
      background: #fffbe6;
      color: #3e2f1c;
    }
    .form-control:focus, .form-select:focus {
      border-color: #3e2f1c;
      box-shadow: 0 0 0 2px #e5dcc3;
    }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../bootstrap/bootstrap.min.css">
</head>
<body>
     <img src="https://cdn-icons-png.flaticon.com/512/29/29302.png" alt="Livro" class="logo">
   <h2 class="mb-4 text-center">Cadastro de Livros</h2>


<div class="row ">
  <div class="col-3">
    <input type="hidden" id="id">
    <div class="input-group mb-3">                    
      <input type="text" class="form-control" id="nome" placeholder="Nome do Livro">
    </div>
  </div>

  <div class="col-3">
    <div class="input-group mb-3">                    
      <input type="number" class="form-control" id="paginas" placeholder="Nº de Páginas">
    </div>
  </div>

  <div class="col-3">
    <div class="input-group mb-3">
      <input type="number" class="form-control" id="preco" placeholder="Preço">
    </div>
  </div>
  <div class="col-3">
    <div class="form-floating">
      <select class="form-select" id="ativo" >
        <option selected>Selecione:</option>
        <option value="1">Disponível</option>
        <option value="0">Indisponível</option>
      </select>
      <label for="floatingSelect">Selecione se Disponível ou Não</label>
    </div>
  </div>
        
  <div class="col-12 d-flex gap-2">
    <button type="button" class="btn btn-success" onclick="salvar()" id="botaoSalvar">Salvar</button>
    <button type="button" class="btn btn-secondary" onclick="limpar()" id="botaoLimpar">Limpar</button>
  </div>
</div><br>

<form class="d-flex" role="search">
  <input class="form-control me-2" type="search" placeholder="Pesquise o Livro" id="pesquisa"/>
  <button onclick="carregar()" type="button" class="btn btn-secondary" id="botaoListar">Listar Livros</button>
  <button class="btn btn-outline-success" type="submit" onclick="carregarPesquisa()" id="botao">Pesquisar</button>
</form>

<table id="tabela">
  <thead>
    <tr>
      <th>ID</th>
      <th>Nome do Livro</th>
      <th>Nº de Páginas</th>
      <th>Preço</th>
      <th>Status:</th>
      <th>Ação</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const url_api = "https://localhost/IW2B/prova3bi/prova.php";

  function carregar(pesquisa = ""){
    let url= url_api;
    if (pesquisa){
      url += "?pesquisa=" + encodeURIComponent(pesquisa);
    }
    const tbody=document.querySelector("#tabela tbody");
    tbody.innerHTML = "";
    fetch(url)
      .then(resposta => resposta.json())
      .then(dados => {
        dados.forEach(livro => {
          const tr =document.createElement("tr");
          tr.innerHTML =`
            <td>${livro.id}</td>
            <td>${livro.nome}</td>
            <td>${livro.paginas}</td> 
            <td>${livro.preco}</td> 
            <td>${livro.ativo ==1 ? "Disponível" :"Indisponível"}</td>
            <td>
              <button onclick='editar(${JSON.stringify(livro)})'>Editar</button>
              <button onclick='excluir(${livro.id})'>Excluir</button>
            </td> 
          `;
          tbody.appendChild(tr);
        });
      })
  }

  function carregarPesquisa(){
    const valor = document.getElementById("pesquisa").value;
    carregar(valor);
  }
  
  async function salvar(){
    const id=document.getElementById("id").value;
    const nome=document.getElementById("nome").value;
    const paginas=document.getElementById("paginas").value;
    const preco=document.getElementById("preco").value;
    const ativo=document.getElementById("ativo").value;

    const payload = {ID: id, NOME: nome, PAGINAS: paginas, PRECO: preco, ATIVO : ativo};

    if(id){
      await fetch (url_api,{method: "PUT", body: JSON.stringify(payload)});
    }
    else{
      await fetch (url_api,{method: "POST", body: JSON.stringify(payload)});
    }

    limpar();
    carregar();
  }

  function editar(livro){
    document.getElementById("id").value = livro.id;
    document.getElementById("nome").value= livro.nome;
    document.getElementById("paginas").value= livro.paginas;
    document.getElementById("preco").value= livro.preco;
    document.getElementById("ativo").value= livro.ativo;
  }

  async function excluir(id){
    if (confirm("Deseja mesmo excluir este livro?")){
      await fetch (url_api + "?id=" + id, {method: "DELETE"});
      carregar();
    }
  }

  function limpar(){
    document.getElementById("id").value = "";
    document.getElementById("nome").value= "";
    document.getElementById("paginas").value = "";
    document.getElementById("preco").value = "";
    document.getElementById("ativo").value = "1";
  }
  carregar();
</script>
</body>
</html>